/**
 * DevExtreme (esm/__internal/ui/file_manager/ui.file_manager.command_manager.js)
 * Version: 25.2.3
 * Build date: Fri Dec 12 2025
 *
 * Copyright (c) 2012 - 2025 Developer Express Inc. ALL RIGHTS RESERVED
 * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/
 */
import messageLocalization from "../../../common/core/localization/message";
import {
    extend
} from "../../../core/utils/extend";
import {
    each
} from "../../../core/utils/iterator";
import {
    isString
} from "../../../core/utils/type";
export const defaultPermissions = {
    create: false,
    copy: false,
    move: false,
    delete: false,
    rename: false,
    upload: false,
    download: false
};
export class FileManagerCommandManager {
    constructor(permissions) {
        this._actions = {};
        this._permissions = permissions ?? {};
        this._initCommands()
    }
    _initCommands() {
        var _this$_permissions, _this$_permissions2, _this$_permissions3, _this$_permissions4, _this$_permissions5, _this$_permissions6, _this$_permissions7;
        this._commands = [{
            name: "create",
            text: messageLocalization.format("dxFileManager-commandCreate"),
            icon: "newfolder",
            enabled: null === (_this$_permissions = this._permissions) || void 0 === _this$_permissions ? void 0 : _this$_permissions.create,
            noFileItemRequired: true
        }, {
            name: "rename",
            text: messageLocalization.format("dxFileManager-commandRename"),
            icon: "rename",
            enabled: null === (_this$_permissions2 = this._permissions) || void 0 === _this$_permissions2 ? void 0 : _this$_permissions2.rename,
            isSingleFileItemCommand: true
        }, {
            name: "move",
            text: messageLocalization.format("dxFileManager-commandMove"),
            icon: "movetofolder",
            enabled: null === (_this$_permissions3 = this._permissions) || void 0 === _this$_permissions3 ? void 0 : _this$_permissions3.move
        }, {
            name: "copy",
            text: messageLocalization.format("dxFileManager-commandCopy"),
            icon: "copy",
            enabled: null === (_this$_permissions4 = this._permissions) || void 0 === _this$_permissions4 ? void 0 : _this$_permissions4.copy
        }, {
            name: "delete",
            text: messageLocalization.format("dxFileManager-commandDelete"),
            icon: "trash",
            enabled: null === (_this$_permissions5 = this._permissions) || void 0 === _this$_permissions5 ? void 0 : _this$_permissions5.delete
        }, {
            name: "download",
            text: messageLocalization.format("dxFileManager-commandDownload"),
            icon: "download",
            enabled: null === (_this$_permissions6 = this._permissions) || void 0 === _this$_permissions6 ? void 0 : _this$_permissions6.download
        }, {
            name: "upload",
            text: messageLocalization.format("dxFileManager-commandUpload"),
            icon: "upload",
            enabled: null === (_this$_permissions7 = this._permissions) || void 0 === _this$_permissions7 ? void 0 : _this$_permissions7.upload,
            noFileItemRequired: true
        }, {
            name: "refresh",
            text: messageLocalization.format("dxFileManager-commandRefresh"),
            icon: "dx-filemanager-i dx-filemanager-i-refresh",
            enabled: true,
            noFileItemRequired: true
        }, {
            name: "thumbnails",
            text: messageLocalization.format("dxFileManager-commandThumbnails"),
            icon: "mediumiconslayout",
            enabled: true,
            noFileItemRequired: true
        }, {
            name: "details",
            text: messageLocalization.format("dxFileManager-commandDetails"),
            icon: "detailslayout",
            enabled: true,
            noFileItemRequired: true
        }, {
            name: "clearSelection",
            text: messageLocalization.format("dxFileManager-commandClearSelection"),
            icon: "remove",
            enabled: true
        }, {
            name: "showNavPane",
            hint: messageLocalization.format("dxFileManager-commandShowNavPane"),
            icon: "menu",
            enabled: false,
            noFileItemRequired: true
        }];
        this._commandMap = {};
        this._commands.forEach((command => {
            this._commandMap[command.name] = command
        }))
    }
    registerActions(actions) {
        this._actions = extend(this._actions, actions)
    }
    executeCommand(command, arg) {
        const commandName = isString(command) ? command : command.name;
        const action = this._actions[commandName];
        if (action) {
            return action(arg)
        }
    }
    updatePermissions(permissions) {
        this._permissions = Object.assign({}, defaultPermissions, permissions);
        each(this._permissions, (permission => {
            var _this$_permissions8;
            this._commandMap[permission].enabled = null === (_this$_permissions8 = this._permissions) || void 0 === _this$_permissions8 ? void 0 : _this$_permissions8[permission]
        }))
    }
    setCommandEnabled(commandName, enabled) {
        const command = this.getCommandByName(commandName);
        if (command) {
            command.enabled = enabled
        }
    }
    getCommandByName(name) {
        return this._commandMap[name]
    }
    isCommandAvailable(commandName, itemInfos) {
        const command = this.getCommandByName(commandName);
        if (!(null !== command && void 0 !== command && command.enabled)) {
            return false
        }
        if (command.noFileItemRequired) {
            return true
        }
        const itemsLength = (null === itemInfos || void 0 === itemInfos ? void 0 : itemInfos.length) || 0;
        if (0 === itemsLength || itemInfos.some((item => item.fileItem.isRoot() || item.fileItem.isParentFolder))) {
            return false
        }
        if ("download" === commandName) {
            return itemInfos.every((itemInfo => !itemInfo.fileItem.isDirectory))
        }
        return !command.isSingleFileItemCommand || 1 === itemsLength
    }
}
