/**
 * DevExtreme (esm/__internal/scheduler/view_model/preparation/utils/replace_incorrect_end_date.js)
 * Version: 25.2.3
 * Build date: Fri Dec 12 2025
 *
 * Copyright (c) 2012 - 2025 Developer Express Inc. ALL RIGHTS RESERVED
 * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/
 */
import {
    dateUtilsTs
} from "../../../../core/utils/date";
import {
    dateUtils
} from "../../../../core/utils/m_date";
const toMs = dateUtils.dateToMilliseconds;
export const replaceIncorrectEndDate = (rawAppointments, appointmentMinDuration, dataAccessors) => {
    if (!rawAppointments) {
        return []
    }
    return rawAppointments.reduce(((result, rawAppointment) => {
        const startDate = dataAccessors.get("startDate", rawAppointment);
        const endDate = dataAccessors.get("endDate", rawAppointment);
        if (!dateUtilsTs.isValidDate(startDate)) {
            return result
        }
        const isEndDateIncorrect = !dateUtilsTs.isValidDate(endDate) || startDate.getTime() > endDate.getTime();
        if (isEndDateIncorrect) {
            const isAllDay = dataAccessors.get("allDay", rawAppointment);
            const correctedEndDate = isAllDay ? dateUtils.setToDayEnd(new Date(startDate)) : new Date(startDate.getTime() + appointmentMinDuration * toMs("minute"));
            dataAccessors.set("endDate", rawAppointment, correctedEndDate)
        }
        result.push(rawAppointment);
        return result
    }), [])
};
